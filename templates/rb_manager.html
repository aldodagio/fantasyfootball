<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/prediction_view.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/global.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <title>Running Back Manager</title>
</head>
<body>
<!-- Header/Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="/">The Fantasy Football Cheat Code</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="../linear_regression">Machine Learning</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
</nav>
<div class="container mt-5">
    <h1>Running Back Manager</h1>
    <hr>
    <!-- Player Search Results -->
    <div class="mt-4 row">
        <div class="col-md-12">
            <h2>Click a player to update or delete</h2>
            <ul class="list-group">
                {% for p in players %}
                <li class="list-group-item" id="player-{{ loop.index }}">
                    <strong>{{ loop.index }}.</strong> {{ p.first_name }} {{ p.last_name }}, {{ p.team }}
                    <button class="btn btn-warning btn-sm ml-2" onclick="updatePlayer('{{ p.id }}', {{ loop.index }})">Update</button>
                    <button class="btn btn-danger btn-sm ml-2" onclick="deletePlayer('{{ p.id }}', {{ loop.index }})">Delete</button>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
<script>
function updatePlayer(player_id, index) {
    const options = ['First Name', 'Last Name', 'Team'];
let choice = prompt(`Choose an option by entering the number:
1. ${options[0]}
2. ${options[1]}
3. ${options[2]}
`);

if (choice >= 1 && choice <= 3) {
    if(choice == 1) {
    const first_name = prompt("Enter the new first name for this player:");
    if (first_name) {
        fetch(`/update_player_first_name`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ player_id: player_id, first_name: first_name })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Player updated successfully!');
                location.reload();
            } else {
                alert('Error updating player: ' + data.error);
            }
        });
    }
    }
    else if(choice == 2) {
    const last_name = prompt("Enter the new last name for this player:");
    if (last_name) {
        fetch(`/update_player_last_name`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ player_id: player_id, last_name: last_name })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Player updated successfully!');
                location.reload();
            } else {
                alert('Error updating player: ' + data.error);
            }
        });
    }
    }
else if (choice == 3) {
    const nflTeams = [
        "Arizona Cardinals", "Atlanta Falcons", "Baltimore Ravens", "Buffalo Bills",
        "Carolina Panthers", "Chicago Bears", "Cincinnati Bengals", "Cleveland Browns",
        "Dallas Cowboys", "Denver Broncos", "Detroit Lions", "Green Bay Packers",
        "Houston Texans", "Indianapolis Colts", "Jacksonville Jaguars", "Kansas City Chiefs",
        "Las Vegas Raiders", "Los Angeles Chargers", "Los Angeles Rams", "Miami Dolphins",
        "Minnesota Vikings", "New England Patriots", "New Orleans Saints", "New York Giants",
        "New York Jets", "Philadelphia Eagles", "Pittsburgh Steelers", "San Francisco 49ers",
        "Seattle Seahawks", "Tampa Bay Buccaneers", "Tennessee Titans", "Washington Commanders"
    ];

    // Generate team options for prompt
    let teamList = nflTeams.map((team, index) => `${index + 1}. ${team}`).join('\n');
    let choice = prompt(`Select the new team for this player by entering the number:\n${teamList}`);

    const teamIndex = parseInt(choice) - 1;

    if (teamIndex >= 0 && teamIndex < nflTeams.length) {
        const team_name = nflTeams[teamIndex];
        fetch(`/update_player_team`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ player_id: player_id, team_name: team_name })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Player updated successfully!');
                location.reload();
            } else {
                alert('Error updating player: ' + data.error);
            }
        });
    } else {
        alert("Invalid choice. Please try again.");
    }
}
} else {
    alert("Invalid choice. Please select a number between 1 and 4.");
}
}

function deletePlayer(name, index) {
    if (confirm(`Are you sure you want to delete ${name}?`)) {
        fetch(`/delete_player`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Player deleted successfully!');
                document.getElementById(`player-${index}`).remove();
            } else {
                alert('Error deleting player: ' + data.error);
            }
        });
    }
}
</script>
</body>
</html>